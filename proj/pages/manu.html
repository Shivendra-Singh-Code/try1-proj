<!DOCTYPE html>
<html lang="en">
  <header>
    <head>
      <meta charset="UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Manufacturer</title>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
      <script src="./App.js"></script>
      <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>\
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js" integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk=" crossorigin="anonymous"></script>
    </head>
  </header>

  <main>
    <body>
      <h1>Add Product details</h1>
      <form id="mfform">
        <label for="text">Product ID:</label>
        <input type="number" id="Product ID" name="Product ID" required />
        <br /><br />

        <label for="Product Name">Product Name: </label>
        <input type="text" id="Product Name" name="Product Name" /><br /><br />

        <label for="Current State">Current State:</label>
        <input
          type="text"
          id="Current State"
          name="Current STate"
        /><br /><br />

        <label for="Source Address">Source Address: </label>
        <input
          type="text"
          id="Source Address"
          name="Source Address"
        /><br /><br />

        <label for="Destination Address">Destination Address: </label>
        <input
          type="text"
          id="Destination Address"
          name="Destination Address"
        /><br /><br />

        <label for="Role">Role ID: </label>
        <input type="text" id="Role" name="Role" /><br /><br />

        <button type="submit">Submit</button>
      </form>
      <div id="qrcode"></div>

      <script src="https://cdn.jsdelivr.net/npm/web3@1.3.5/dist/web3.min.js"></script>
      <script>
        const web3 = new Web3(
          new Web3.providers.HttpProvider(
            "https://mainnet.infura.io/v3/2NdECkbh5b45c5DX5yc4aA9V9jo"
          )
        );
        
        
        const contract = new web3.eth.Contract(proabi, address);

        window.onload = function () {
          alert(document.getElementById("Product ID"));
        };
        const proID = document.getElementById("Product ID").value;
        const proname = document.getElementById("Product Name").value;
        const cstate = document.getElementById("Current State").value;
        const source = document.getElementById("Source Address").value;
        const destination = document.getElementById(
          "Destination Address"
        ).value;
        const roleID = document.getElementById("Role").value;
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        contract.methods
          .create_prod(proID, proname, cstate, source, destination, roleID)
          .send({ from: '0xe2fB82fEe92ab6ac729E56541B2D342DaA3F4F08' })
          .then(function (receipt) {
            console.log(receipt);
          });

        //QR Code generator
        document
          .getElementById("mfform")
          .addEventListener("submit", function (e) {
            e.preventDefault(); // prevent form submission
            var pro_ID = document.getElementById("Product ID").value; // get input value
            var pro_name = document.getElementById("Product Name").value;
            generateQRCode(text); // generate QR code
          });

        function generateQRCode(text, text) {
          var qrcode = new QRCode(document.getElementById("qrcode"), {
            text: text,
            width: 256,
            height: 256,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.L, // set error correction level
          });
        }
      </script>
    </body>
  </main>
</html>
